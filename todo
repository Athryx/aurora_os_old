make thred_new return the correct error code

make threading more safe
